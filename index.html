<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
  <meta charset="UTF-8">
  <title>Minecraft Clock</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">

  <style>
    .clockImage {
      width: 15vw;
      image-rendering: pixelated;
      opacity: 0;
      transition: opacity 300ms ease-in-out;
    }
  </style>
  <style>
    @font-face {
      font-family: 'MinecraftRegular';
      src: url('MinecraftRegular-Bmg3.otf') format('opentype');
    }

    body {
      font-family: 'MinecraftRegular', sans-serif;
    }
  </style>
  <link href='https://fonts.googleapis.com/css?family=Orbitron' rel='stylesheet' type='text/css'>
</head>

<body>
  <!-- START NAV -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">Minecraft Clock</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="generate-clock.html">Generate Clock</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="full-screen.html">Full Screen Mode</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="cache-assets.html">Cache Assets</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="">About</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- END NAV -->
  <div class="container text-center clocks">
    <h3 class="mt-5" style="margin-bottom: 10px;" id="mainClockTitle">Main Clock</h3>
    <img class="clockImage" style="margin-bottom: 10px;" src="clock/frame_00_delay-0.05s.gif" alt="Minecraft Clock">
    <div class="clockTime" style="font-size: xx-large;">00:00:00</div>
  </div>

  <div class="container text-center">
    <div class="row">
      <div class="col">
        <div class="container text-center clocks">
          <h5 class="mt-5" style="margin-bottom: 10px;">Europe/London</h5>
          <img class="clockImage" style="margin-bottom: 10px; width: 10vw;" src="clock/frame_00_delay-0.05s.gif" alt="Minecraft Clock">
          <div class="clockTime" style="font-size: x-large;">00:00:00</div>
        </div>
      </div>
      <div class="col">
        <div class="container text-center clocks">
          <h5 class="mt-5" style="margin-bottom: 10px;">Asia/Tokyo</h5>
          <img class="clockImage" style="margin-bottom: 10px; width: 10vw;" src="clock/frame_00_delay-0.05s.gif" alt="Minecraft Clock">
          <div class="clockTime" style="font-size: x-large;">00:00:00</div>
        </div>
      </div>
      <div class="col">
        <div class="container text-center clocks">
          <h5 class="mt-5" style="margin-bottom: 10px;">America/New_York</h5>
          <img class="clockImage" style="margin-bottom: 10px; width: 10vw;" src="clock/frame_00_delay-0.05s.gif" alt="Minecraft Clock">
          <div class="clockTime" style="font-size: x-large;">00:00:00</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    class MinecraftClock {
      constructor(container, timezone) {
        this.container = container;
        this.timezone = timezone;
        this.image = container.querySelector('.clockImage');
        this.timeText = container.querySelector('.clockTime');

        this.init();
      }

      getCurrentFrame(now) {
        const totalMinutes = now.getHours() * 60 + now.getMinutes();
        const fraction = totalMinutes / (24 * 60);
        let frame = Math.floor(fraction * 64);
        frame = (frame + 32) % 64; // shift noon to frame_0
        return frame;
      }

      animateToFrame(targetFrame) {
        const totalSteps = targetFrame;
        const duration = 1200;
        const startTime = performance.now();

        const easeOutBack = (x) => {
          const c1 = 1.70158;
          const c3 = c1 + 1;
          return 1 + c3 * Math.pow(x - 1, 3) + c1 * Math.pow(x - 1, 2);
        };

        const animate = (currentTime) => {
          const elapsed = currentTime - startTime;
          const t = Math.min(elapsed / duration, 1);
          const easedT = easeOutBack(t);
          const currentFrame = Math.floor(easedT * totalSteps);
          let frameStr = String(currentFrame).padStart(2, '0');
          // Not so proud of this
          if (frameStr > 63) {
            switch (Number(frameStr)) {
              case 64:
                frameStr = "00";
                break;
              case 65:
                frameStr = "01";
                break;
              case 66:
                frameStr = "02";
                break;
              case 67:
                frameStr = "03";
                break;
              case 68:
                frameStr = "04";
                break;
              case 69:
                frameStr = "05";
                break;
            }
          }
          this.image.src = `clock/frame_${frameStr}_delay-0.05s.gif`;

          if (t < 1) {
            requestAnimationFrame(animate);
          }
        };

        requestAnimationFrame(animate);
      }

      updateClockFrame() {
        const now = new Date().toLocaleString("en-US", {
          timeZone: this.timezone
        });
        const date = new Date(now);
        const frame = this.getCurrentFrame(date);
        const frameStr = String(frame).padStart(2, '0');
        this.image.src = `clock/frame_${frameStr}_delay-0.05s.gif`;
      }

      updateDigitalClock() {
        const now = new Date().toLocaleString("en-US", {
          timeZone: this.timezone
        });
        const date = new Date(now);
        const h = date.getHours().toString().padStart(2, '0');
        const m = date.getMinutes().toString().padStart(2, '0');
        const s = date.getSeconds().toString().padStart(2, '0');
        this.timeText.innerText = `${h}:${m}:${s}`;
      }

      init() {
        this.image.style.opacity = 1;
        this.updateDigitalClock();
        const now = new Date().toLocaleString("en-US", {
          timeZone: this.timezone
        });
        const date = new Date(now);
        const targetFrame = this.getCurrentFrame(date);
        this.animateToFrame(targetFrame);

        setInterval(() => this.updateClockFrame(), 1000);
        setInterval(() => this.updateDigitalClock(), 1000);
      }
    }
  </script>

  <script>
    window.addEventListener('load', () => {
      const containers = document.querySelectorAll('.clocks');

      const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      let timezones = [`${userTimezone}`];
      document.getElementById("mainClockTitle").innerHTML = `${userTimezone}`
      timezones.push('Europe/London', 'Asia/Tokyo', 'America/New_York');

      containers.forEach((container, index) => {
        new MinecraftClock(container, timezones[index]);
      });
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
</body>

</html>